<mat-tab-group [(selectedIndex)]="stat.profileTab"
               (animationDone)="stat.emitTab()">
  <mat-tab label="Profile">
    <div id="stats">
      <button mat-icon-button
              class="refresh"
              (click)="reset()">
        <mat-icon>refresh</mat-icon>
      </button>

      <form>
        <q-name-search [value]="stat.target"
                       (valueChange)="showUser($event)"></q-name-search>
      </form>

      <div id="selection">
        <div class="badges">
          <div *ngFor="let rank of stat.userRanks"
               (click)="showRankLeaders(rank)">
            <div class="badge {{tierTitles[rank.tier]}}"
                 title="Lvl {{rank.level}} {{tierTitles[rank.tier]}} tier">
              {{rank.level}}
            </div>
            <div [title]="rank.title">
              <div class="badgetitle">{{titles[rank.name] || rank.name}}</div>
              <mat-progress-bar mode="determinate"
                                color="accent"
                                [value]="rank.progress">
              </mat-progress-bar>
            </div>
          </div>
        </div>

        <mat-form-field>
          <mat-select [(value)]="stat.group"
                      (valueChange)="stat.updateWinLoss()"
                      placeholder="Category">
            <mat-option [value]="0">Quacken</mat-option>
            <mat-option [value]="1">Cadesim</mat-option>
            <mat-option [value]="2">Sea Battle</mat-option>
            <mat-option [value]="3">Capture the Flag</mat-option>
          </mat-select>
        </mat-form-field>

        <ng-container *ngIf="stat.group >= 1">
          <h4>Win/Loss last 30 days:</h4>
          <p>{{stat.winLoss.wins}} - {{stat.winLoss.losses}}</p>

          <ng-container *ngIf="stat.winLoss.winsVsMe || stat.winLoss.lossesVsMe">
            <h4>Win/Loss vs you:</h4>
            <p>{{stat.winLoss.winsVsMe}} - {{stat.winLoss.lossesVsMe}}</p>
          </ng-container>
        </ng-container>

        <table *ngIf="stat.groupStats">
          <tr *ngFor="let s of stat.groupStats[stat.group]"
              class="stat"
              (click)="showLeaders(s)">
            <td>{{s.name}}</td>
            <td>{{s.value || '-'}}<span *ngIf="s.suffix && s.value"> {{s.suffix}}</span></td>
          </tr>
        </table>
      </div>
    </div>
  </mat-tab>

  <mat-tab label="Friends">
    <mat-expansion-panel expanded>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Online
        </mat-panel-title>
        <mat-panel-description>
          ({{fs.friends.length}})
        </mat-panel-description>
      </mat-expansion-panel-header>
      <ng-template matExpansionPanelContent>
        <div *ngFor="let friend of fs.friends"
             class="online"
             [matMenuTriggerFor]="onlineMenu"
             [matMenuTriggerData]="{friend: friend}">
          {{friend}}
        </div>
      </ng-template>
    </mat-expansion-panel>
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Offline
        </mat-panel-title>
        <mat-panel-description>
          ({{fs.offline.length}})
        </mat-panel-description>
      </mat-expansion-panel-header>
      <ng-template matExpansionPanelContent>
        <div *ngFor="let friend of fs.offline"
             class="offline"
             [matMenuTriggerFor]="offlineMenu"
             [matMenuTriggerData]="{friend: friend}">
          {{friend}}
        </div>
      </ng-template>
    </mat-expansion-panel>
  </mat-tab>

  <mat-tab label="Blocked">
    <p *ngIf="!fs.blocked.length; else blockCount"
       class="empty">
      No blocked players. Hooray!
    </p>
    <ng-template #blockCount>
      <p class="empty">
        {{fs.blocked.length}} blocked player<span *ngIf="fs.blocked.length > 1">s</span>.
      </p>
    </ng-template>
    <div *ngFor="let blocked of fs.blocked"
         class="lobbyPlayer offline"
         [matMenuTriggerFor]="blockedMenu"
         [matMenuTriggerData]="{blocked: blocked}">
      {{blocked}}
    </div>
  </mat-tab>

  <mat-tab label="Leaderboards">
    <q-leaders [name]='ws.user?.name'></q-leaders>
  </mat-tab>

  <mat-tab label="Matches">
    <q-matches></q-matches>
  </mat-tab>
</mat-tab-group>


<mat-menu #onlineMenu="matMenu">
  <ng-template matMenuContent
               let-friend="friend">
    <button mat-menu-item
            (click)="stat.openUser(friend)">
      Profile
    </button>
    <button mat-menu-item
            (click)="sendTell(friend)">
      Send Tell
    </button>
    <button *ngIf="fs.allowInvite"
            mat-menu-item
            (click)="invite(friend)">
      Invite to Lobby
    </button>
    <button mat-menu-item
            (click)="remove(friend)">
      Remove
    </button>
  </ng-template>
</mat-menu>

<mat-menu #offlineMenu="matMenu">
  <ng-template matMenuContent
               let-friend="friend">
    <button mat-menu-item
            (click)="stat.openUser(friend)">
      Profile
    </button>
    <button mat-menu-item
            (click)="remove(friend)">
      Remove
    </button>
  </ng-template>
</mat-menu>

<mat-menu #blockedMenu="matMenu">
  <ng-template matMenuContent
               let-blocked="blocked">
    <button mat-menu-item
            (click)="stat.openUser(blocked)">
      Profile
    </button>
    <button mat-menu-item
            (click)="unblock(blocked)">
      Unblock
    </button>
  </ng-template>
</mat-menu>
